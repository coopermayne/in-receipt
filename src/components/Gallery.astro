---
import ProjectCard from './ProjectCard.astro';
import ScrollIndicator from './ScrollIndicator.astro';

interface Project {
  id: string;
  title: string;
  category: string;
  thumbnail: string;
  shortDescription: string;
  fullDescription: string;
  images: string[];
  year?: string;
  location?: string;
  type?: string;
}

interface Props {
  projects: Project[];
}

const { projects } = Astro.props;

const residential = projects.filter(p => p.category === 'residential');
const commercial = projects.filter(p => p.category === 'commercial');
---

<main class="main-gallery">
  <!-- Mobile: Horizontal Rows (hidden on desktop) -->
  <div class="gallery-row-container" data-category="residential">
    <div class="gallery-row" data-gallery-id="residential">
      {residential.map((project, index) => (
        <ProjectCard {...project} isFirst={index === 0} />
      ))}
    </div>
    <ScrollIndicator count={residential.length} galleryId="residential" />
  </div>

  <div class="gallery-row-container" data-category="commercial">
    <div class="gallery-row" data-gallery-id="commercial">
      {commercial.map((project, index) => (
        <ProjectCard {...project} isFirst={index === 0} />
      ))}
    </div>
    <ScrollIndicator count={commercial.length} galleryId="commercial" />
  </div>

  <!-- Mobile: Info Button -->
  <button class="mobile-info-btn" aria-label="Contact information">
    <span class="mobile-info-btn__icon">i</span>
  </button>

  <!-- Mobile: Contact Popup -->
  <div class="mobile-contact-popup">
    <div class="mobile-contact-popup__inner">
      <button class="mobile-contact-popup__close" aria-label="Close">&times;</button>
      <h2 class="mobile-contact-popup__title">IN RECEIPT</h2>
      <div class="mobile-contact-popup__content">
        <p>Architecture Studio</p>
        <p>info@inreceipt.com</p>
        <p>+1 (555) 123-4567</p>
      </div>
    </div>
  </div>

  <!-- Desktop: Sliding Layout -->
  <!-- Order: [left-page] | Col1 | Empty | Contact | Col4 | [right-page] -->

  <!-- Off-screen Left Project Page (50vw, slides in from left) -->
  <div class="project-page project-page--left" id="project-page-left">
    <div class="project-page__panel">
      <div class="project-page__content">
        <div class="project-page__meta">
          <div class="project-page__meta-item">
            <span class="project-page__meta-label">Year</span>
            <span class="project-page__meta-value" data-field="year"></span>
          </div>
          <div class="project-page__meta-item">
            <span class="project-page__meta-label">Location</span>
            <span class="project-page__meta-value" data-field="location"></span>
          </div>
          <div class="project-page__meta-item">
            <span class="project-page__meta-label">Type</span>
            <span class="project-page__meta-value" data-field="type"></span>
          </div>
        </div>
        <p class="project-page__description" data-field="description"></p>
        <div class="project-page__gallery" data-field="gallery"></div>
      </div>
    </div>
  </div>

  <!-- Column 1: Residential Projects (25vw, dotted right border, right-aligned) -->
  <div class="gallery-column-container gallery-column-container--col1">
    <div class="gallery-column gallery-column--left" data-gallery-id="column-left">
      {residential.map((project, index) => (
        <ProjectCard {...project} isFirst={index === 0} />
      ))}
    </div>
  </div>

  <!-- Column 2: Empty Space (37.5vw) -->
  <div class="gallery-column-container gallery-column-container--empty"></div>

  <!-- Column 3: Contact Sidebar (12.5vw, white lines both sides) -->
  <aside class="contact-sidebar">
    <h1 class="site-title">IN RECEIPT</h1>
  </aside>

  <!-- Column 4: Commercial Projects (25vw, left-aligned) -->
  <div class="gallery-column-container gallery-column-container--col4">
    <div class="gallery-column gallery-column--right" data-gallery-id="column-right">
      {commercial.map((project, index) => (
        <ProjectCard {...project} isFirst={index === 0} />
      ))}
    </div>
  </div>

  <!-- Off-screen Right Project Page (15vw, slides in from right) -->
  <div class="project-page project-page--right" id="project-page-right">
    <div class="project-page__panel">
      <div class="project-page__content">
        <div class="project-page__meta">
          <div class="project-page__meta-item">
            <span class="project-page__meta-label">Year</span>
            <span class="project-page__meta-value" data-field="year"></span>
          </div>
          <div class="project-page__meta-item">
            <span class="project-page__meta-label">Location</span>
            <span class="project-page__meta-value" data-field="location"></span>
          </div>
          <div class="project-page__meta-item">
            <span class="project-page__meta-label">Type</span>
            <span class="project-page__meta-value" data-field="type"></span>
          </div>
        </div>
        <div class="project-page__featured-image" data-field="featured-image"></div>
        <p class="project-page__description" data-field="description"></p>
      </div>
    </div>
  </div>

</main>

<!-- Lightbox for full-screen image viewing (outside main-gallery to avoid transform issues) -->
<div class="lightbox" id="lightbox" aria-hidden="true">
  <button class="lightbox__close" aria-label="Close lightbox">&times;</button>

  <!-- Previous nav indicator (vertical line with < chevron) -->
  <button class="lightbox__nav lightbox__nav--prev" aria-label="Previous image">
    <span class="lightbox__nav-line"></span>
    <span class="lightbox__nav-chevron"></span>
    <span class="lightbox__nav-line"></span>
  </button>

  <div class="lightbox__content">
    <img class="lightbox__image" src="" alt="" />
  </div>

  <!-- Next nav indicator (vertical line with > chevron) -->
  <button class="lightbox__nav lightbox__nav--next" aria-label="Next image">
    <span class="lightbox__nav-line"></span>
    <span class="lightbox__nav-chevron"></span>
    <span class="lightbox__nav-line"></span>
  </button>
</div>
